<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§æ€ªè·¯å­æ¯”èµ›è®¡åˆ†ç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            padding: 10px;
            color: #333;
            font-size: 14px;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px;
        }
        
        h1, h2, h3 {
            color: #2c3e50;
            margin-bottom: 12px;
        }
        
        h1 {
            text-align: center;
            color: #2980b9;
            padding-bottom: 12px;
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        h2 {
            color: #3498db;
            margin-top: 20px;
            padding-bottom: 6px;
            border-bottom: 1px dashed #ddd;
            font-size: 1.3rem;
        }
        
        h3 {
            color: #2980b9;
            margin-top: 15px;
            font-size: 1.1rem;
        }
        
        h4 {
            font-size: 1rem;
            margin-bottom: 8px;
        }
        
        .section {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        
        .desktop-only {
            display: none;
        }
        
        @media (min-width: 768px) {
            body {
                padding: 20px;
                font-size: 16px;
            }
            
            .container {
                padding: 25px;
                max-width: 1400px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            h3 {
                font-size: 1.3rem;
            }
            
            .section {
                padding: 20px;
                margin-bottom: 25px;
            }
            
            .desktop-only {
                display: block;
            }
        }
        
        .input-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        @media (min-width: 768px) {
            .input-section {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
        }
        
        .player-input {
            width: 100%;
        }
        
        .player-input label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.9rem;
        }
        
        .player-input input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        @media (min-width: 768px) {
            .button-group {
                flex-direction: row;
            }
        }
        
        button {
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            flex: 1;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        button.reset {
            background-color: #e74c3c;
        }
        
        button.reset:hover {
            background-color: #c0392b;
        }
        
        button.history {
            background-color: #9b59b6;
        }
        
        button.history:hover {
            background-color: #8e44ad;
        }
        
        .game-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }
        
        @media (min-width: 768px) {
            .game-controls {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }
        
        .round-info {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
        }
        
        @media (min-width: 768px) {
            .round-info {
                font-size: 18px;
                text-align: left;
            }
        }
        
        .ranking-input {
            margin-top: 15px;
        }
        
        .ranking-row {
            display: flex;
            flex-direction: column;
            margin-bottom: 12px;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        @media (min-width: 768px) {
            .ranking-row {
                flex-direction: row;
                align-items: center;
            }
        }
        
        .rank-label {
            width: 100%;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        @media (min-width: 768px) {
            .rank-label {
                width: 100px;
                margin-bottom: 0;
            }
        }
        
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            background-color: white;
        }
        
        @media (min-width: 768px) {
            select {
                flex: 1;
            }
        }
        
        .results {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (min-width: 768px) {
            .results {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
            }
        }
        
        .score-card {
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        @media (min-width: 768px) {
            .score-card {
                padding: 20px;
            }
        }
        
        .score-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            min-width: 300px;
        }
        
        .score-table th, .score-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }
        
        @media (min-width: 768px) {
            .score-table th, .score-table td {
                padding: 12px 15px;
                font-size: 1rem;
            }
        }
        
        .score-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .score-table tr:hover {
            background-color: #f5f9ff;
        }
        
        .total-score {
            font-size: 1.3rem;
            font-weight: bold;
            color: #e74c3c;
            text-align: center;
            margin-top: 15px;
        }
        
        @media (min-width: 768px) {
            .total-score {
                font-size: 1.5rem;
            }
        }
        
        .chart-container {
            margin-top: 20px;
            height: 250px;
        }
        
        @media (min-width: 768px) {
            .chart-container {
                height: 300px;
                margin-top: 25px;
            }
        }
        
        .chart-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (min-width: 768px) {
            .chart-row {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
                gap: 20px;
                margin-top: 25px;
            }
        }
        
        .chart-item {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 15px;
            height: 280px;
        }
        
        @media (min-width: 768px) {
            .chart-item {
                padding: 20px;
                height: 320px;
            }
        }
        
        .group-display {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }
        
        @media (min-width: 768px) {
            .group-display {
                flex-direction: row;
                justify-content: space-between;
                gap: 20px;
            }
        }
        
        .group {
            width: 100%;
            padding: 15px;
            background-color: #e8f4fc;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        @media (min-width: 768px) {
            .group {
                flex: 1;
                min-width: 250px;
                padding: 20px;
            }
        }
        
        .group h3 {
            color: #2980b9;
            margin-bottom: 12px;
            text-align: center;
        }
        
        .player-list {
            list-style-type: none;
        }
        
        .player-list li {
            padding: 8px;
            margin-bottom: 6px;
            background-color: white;
            border-radius: 5px;
            border-left: 3px solid #3498db;
        }
        
        .winner {
            color: #27ae60;
            font-weight: bold;
        }
        
        .current-round {
            background-color: #fff8e1;
            border-left: 4px solid #f39c12 !important;
        }
        
        .instructions {
            background-color: #f8f9fa;
            padding: 12px;
            border-radius: 5px;
            margin-top: 15px;
            border-left: 4px solid #2ecc71;
        }
        
        @media (min-width: 768px) {
            .instructions {
                padding: 15px;
                margin-top: 20px;
            }
        }
        
        .instructions h4 {
            color: #27ae60;
            margin-bottom: 8px;
        }
        
        .instructions ul {
            padding-left: 18px;
        }
        
        .instructions li {
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        @media (min-width: 768px) {
            .instructions li {
                font-size: 1rem;
            }
        }
        
        .round-summary {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #3498db;
        }
        
        @media (min-width: 768px) {
            .round-summary {
                padding: 20px;
                margin-top: 20px;
            }
        }
        
        .round-summary h3 {
            margin-top: 0;
        }
        
        .summary-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }
        
        @media (min-width: 768px) {
            .summary-content {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
            }
        }
        
        .summary-item {
            background-color: white;
            padding: 12px;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        @media (min-width: 768px) {
            .summary-item {
                padding: 15px;
            }
        }
        
        .current-leader {
            font-weight: bold;
            color: #e74c3c;
        }
        
        .round-score-display {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }
        
        @media (min-width: 768px) {
            .round-score-display {
                flex-direction: row;
                justify-content: space-around;
                align-items: center;
            }
        }
        
        .team-score {
            text-align: center;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 100%;
        }
        
        @media (min-width: 768px) {
            .team-score {
                min-width: 120px;
                width: auto;
            }
        }
        
        .team-a {
            border-top: 4px solid #3498db;
        }
        
        .team-b {
            border-top: 4px solid #e74c3c;
        }
        
        .team-score h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .team-score .score {
            font-size: 28px;
            font-weight: bold;
        }
        
        @media (min-width: 768px) {
            .team-score .score {
                font-size: 32px;
            }
        }
        
        .team-a .score {
            color: #3498db;
        }
        
        .team-b .score {
            color: #e74c3c;
        }
        
        .vs {
            font-size: 20px;
            font-weight: bold;
            color: #7f8c8d;
            text-align: center;
        }
        
        @media (min-width: 768px) {
            .vs {
                font-size: 24px;
            }
        }
        
        /* ç§»åŠ¨ç«¯æ ‡ç­¾é¡µæ ·å¼ */
        .mobile-tabs-container {
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: white;
            padding: 10px 0;
            margin: -15px -15px 15px -15px;
            border-bottom: 1px solid #ddd;
        }
        
        .mobile-tabs {
            display: flex;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0 15px;
        }
        
        @media (min-width: 768px) {
            .mobile-tabs-container {
                display: none;
            }
        }
        
        .mobile-tab {
            padding: 8px 15px;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: bold;
            color: #7f8c8d;
        }
        
        .mobile-tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }
        
        .page-section {
            display: none;
        }
        
        .page-section.active {
            display: block;
        }
        
        .all-rounds-stats {
            margin-top: 20px;
        }
        
        .all-rounds-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            overflow-x: auto;
            display: block;
        }
        
        .all-rounds-table th, .all-rounds-table td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
            min-width: 80px;
        }
        
        @media (min-width: 768px) {
            .all-rounds-table th, .all-rounds-table td {
                padding: 10px 12px;
                font-size: 0.9rem;
                min-width: 100px;
            }
        }
        
        .all-rounds-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
            position: sticky;
            left: 0;
        }
        
        .all-rounds-table tr:hover {
            background-color: #f5f9ff;
        }
        
        .player-name-cell {
            position: sticky;
            left: 0;
            background-color: #f8f9fa;
            font-weight: bold;
            min-width: 80px;
        }
        
        .group-a-player {
            color: #3498db;
        }
        
        .group-b-player {
            color: #e74c3c;
        }
        
        .first-place {
            background-color: rgba(255, 215, 0, 0.2);
            font-weight: bold;
        }
        
        .last-place {
            background-color: rgba(255, 0, 0, 0.1);
        }
        
        .stats-summary {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (min-width: 768px) {
            .stats-summary {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
        }
        
        .stats-item {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .stats-item h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .stat-box {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3498db;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        @media (min-width: 768px) {
            .action-buttons {
                flex-direction: row;
                justify-content: center;
            }
        }
        
        .action-button {
            padding: 12px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            text-align: center;
            text-decoration: none;
        }
        
        .action-button:hover {
            background-color: #27ae60;
        }
        
        .action-button.secondary {
            background-color: #95a5a6;
        }
        
        .action-button.secondary:hover {
            background-color: #7f8c8d;
        }
        
        /* å†å²è®°å½•æ ·å¼ */
        .history-section {
            margin-top: 20px;
        }
        
        .history-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        @media (min-width: 768px) {
            .history-controls {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }
        
        .history-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .history-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .history-item:hover {
            background-color: #f5f9ff;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-item.active {
            background-color: #e8f4fc;
            border-left: 4px solid #3498db;
        }
        
        .history-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .history-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .history-stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .history-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .history-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .history-action-btn {
            padding: 5px 10px;
            font-size: 0.8rem;
            border-radius: 3px;
            border: none;
            cursor: pointer;
        }
        
        .load-btn {
            background-color: #3498db;
            color: white;
        }
        
        .delete-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .export-btn {
            background-color: #2ecc71;
            color: white;
        }
        
        .no-history {
            text-align: center;
            padding: 30px;
            color: #95a5a6;
        }
        
        .history-details {
            margin-top: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .history-details h3 {
            margin-top: 0;
        }
        
        .save-current-game {
            margin-top: 15px;
            padding: 15px;
            background-color: #fff8e1;
            border-radius: 5px;
            border-left: 4px solid #f39c12;
        }
        
        .save-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        @media (min-width: 768px) {
            .save-form {
                flex-direction: row;
                align-items: center;
            }
        }
        
        .save-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .save-button {
            padding: 10px 20px;
            background-color: #9b59b6;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .save-button:hover {
            background-color: #8e44ad;
        }
        
        /* ç§»åŠ¨ç«¯å¯¼èˆªæç¤º */
        .mobile-nav-hint {
            background-color: #fff8e1;
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
            border-left: 4px solid #f39c12;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        @media (min-width: 768px) {
            .mobile-nav-hint {
                display: none;
            }
        }
        
        .mobile-nav-hint .icon {
            font-size: 1.2rem;
        }
        
        /* è§„åˆ™è¯´æ˜ç‰¹æ®Šæ ·å¼ */
        .rule-highlight {
            background-color: #fff8e1;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
            border-left: 3px solid #e74c3c;
        }
		
		/* Betting */
		.betting-section {
            margin-top: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #f39c12;
        }
        
        .betting-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
        }
        
        .betting-tab {
            padding: 10px 15px;
            cursor: pointer;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        
        .betting-tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: bold;
            color: #f39c12;
        }
        
        .betting-content {
            display: none;
        }
        
        .betting-content.active {
            display: block;
        }
        
        .betting-type {
            margin-bottom: 20px;
        }
        
        .betting-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        @media (min-width: 768px) {
            .betting-controls {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
        }
        
        .bet-control {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .bet-control label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .bet-control select, .bet-control input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .bet-amount-input {
            position: relative;
        }
        
        .bet-amount-slider {
            width: 100%;
            margin-top: 10px;
        }
        
        .bet-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .bet-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .place-bet-btn {
            background-color: #2ecc71;
            color: white;
            flex: 2;
        }
        
        .place-bet-btn:hover {
            background-color: #27ae60;
        }
        
        .clear-bet-btn {
            background-color: #e74c3c;
            color: white;
            flex: 1;
        }
        
        .clear-bet-btn:hover {
            background-color: #c0392b;
        }
        
        .points-display {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .player-points {
            padding: 8px 12px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .player-points.group-a {
            border-left: 3px solid #3498db;
        }
        
        .player-points.group-b {
            border-left: 3px solid #e74c3c;
        }
        
        .player-points .name {
            font-weight: bold;
        }
        
        .player-points .points {
            font-weight: bold;
            color: #f39c12;
        }
        
        .current-bets {
            margin-top: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            max-height: 200px;
            overflow-y: auto;
        }
        
        .current-bets h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .bet-item {
            padding: 8px;
            margin-bottom: 5px;
            background-color: #f8f9fa;
            border-radius: 3px;
            border-left: 3px solid #9b59b6;
            font-size: 0.9rem;
        }
        
        .bet-item.win-bet {
            border-left-color: #2ecc71;
        }
        
        .bet-item.rank-bet {
            border-left-color: #9b59b6;
        }
        
        .bet-item .bet-info {
            display: flex;
            justify-content: space-between;
        }
        
        .bet-item .bet-type {
            font-weight: bold;
            color: #7f8c8d;
        }
        
        .bet-item .bet-amount {
            font-weight: bold;
            color: #e74c3c;
        }
        
        .betting-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #fff8e1;
            border-radius: 5px;
            border-left: 4px solid #f39c12;
        }
        
        .betting-status .status-text {
            font-weight: bold;
        }
        
        .betting-status .lock-btn {
            padding: 5px 10px;
            background-color: #f39c12;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .betting-status .lock-btn:hover {
            background-color: #d68910;
        }
        
        .betting-status .lock-btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .settlement-results {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f6f3;
            border-radius: 5px;
            border-left: 4px solid #2ecc71;
        }
        
        .settlement-item {
            padding: 8px;
            margin-bottom: 5px;
            background-color: white;
            border-radius: 3px;
            border-left: 3px solid #27ae60;
        }
        
        .settlement-item.win {
            border-left-color: #27ae60;
        }
        
        .settlement-item.loss {
            border-left-color: #e74c3c;
        }
        
        .odds-display {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .odds-item {
            padding: 5px 10px;
            background-color: white;
            border-radius: 3px;
            border: 1px solid #ddd;
            font-size: 0.9rem;
        }
        
        .odds-item .rank {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .odds-item .odds {
            font-weight: bold;
            color: #e74c3c;
        }
        
        .betting-history {
            margin-top: 15px;
        }
        
        .betting-history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.85rem;
        }
        
        .betting-history-table th, .betting-history-table td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        .betting-history-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .betting-profit {
            font-weight: bold;
        }
        
        .betting-profit.positive {
            color: #27ae60;
        }
        
        .betting-profit.negative {
            color: #e74c3c;
        }
        
        .betting-summary {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        @media (min-width: 768px) {
            .betting-summary {
                flex-direction: row;
                justify-content: space-between;
            }
        }
        
        .summary-item {
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            text-align: center;
            flex: 1;
        }
        
        .summary-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3498db;
        }
        
        .summary-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>å¤§æ€ªè·¯å­æ¯”èµ›è®¡åˆ†ç³»ç»Ÿ</h1>
        
        <!-- ç§»åŠ¨ç«¯æ ‡ç­¾é¡µå¯¼èˆª -->
        <div class="mobile-tabs-container">
            <div class="mobile-tabs">
                <div class="mobile-tab active" data-page="input">è¾“å…¥</div>
                <div class="mobile-tab" data-page="game">æ¯”èµ›</div>
                <div class="mobile-tab" data-page="stats">ç»Ÿè®¡</div>
                <div class="mobile-tab" data-page="visualization">å›¾è¡¨</div>
                <div class="mobile-tab" data-page="results">ç»“æœ</div>
                <div class="mobile-tab" data-page="history">å†å²</div>
            </div>
        </div>
        
        <!-- è¾“å…¥é¡µé¢ -->
        <div id="inputPage" class="page-section active">
            <div class="section">
                <h2>ç¬¬ä¸€æ­¥ï¼šè¾“å…¥é€‰æ‰‹å§“åå’Œåˆ†ç»„</h2>
                <div class="instructions">
                    <h4>åˆ†ç»„è¯´æ˜</h4>
                    <p>è¯·å°†6åé€‰æ‰‹åˆ†ä¸ºä¸¤ç»„ï¼šç”²ç»„ï¼ˆ3äººï¼‰å’Œä¹™ç»„ï¼ˆ3äººï¼‰ã€‚</p>
                </div>
                
                <div class="input-section">
                    <div class="player-input">
                        <label for="player1">ç”²ç»„é€‰æ‰‹1ï¼š</label>
                        <input type="text" id="player1" placeholder="è¯·è¾“å…¥ç”²ç»„é€‰æ‰‹1å§“å">
                    </div>
                    <div class="player-input">
                        <label for="player2">ç”²ç»„é€‰æ‰‹2ï¼š</label>
                        <input type="text" id="player2" placeholder="è¯·è¾“å…¥ç”²ç»„é€‰æ‰‹2å§“å">
                    </div>
                    <div class="player-input">
                        <label for="player3">ç”²ç»„é€‰æ‰‹3ï¼š</label>
                        <input type="text" id="player3" placeholder="è¯·è¾“å…¥ç”²ç»„é€‰æ‰‹3å§“å">
                    </div>
                    <div class="player-input">
                        <label for="player4">ä¹™ç»„é€‰æ‰‹1ï¼š</label>
                        <input type="text" id="player4" placeholder="è¯·è¾“å…¥ä¹™ç»„é€‰æ‰‹1å§“å">
                    </div>
                    <div class="player-input">
                        <label for="player5">ä¹™ç»„é€‰æ‰‹2ï¼š</label>
                        <input type="text" id="player5" placeholder="è¯·è¾“å…¥ä¹™ç»„é€‰æ‰‹2å§“å">
                    </div>
                    <div class="player-input">
                        <label for="player6">ä¹™ç»„é€‰æ‰‹3ï¼š</label>
                        <input type="text" id="player6" placeholder="è¯·è¾“å…¥ä¹™ç»„é€‰æ‰‹3å§“å">
                    </div>
                </div>
                
                <div class="button-group">
                    <button id="startGame">å¼€å§‹æ¯”èµ›</button>
                    <button id="viewHistory" class="history">æŸ¥çœ‹å†å²è®°å½•</button>
                    <button id="resetAll" class="reset">é‡ç½®æ‰€æœ‰æ•°æ®</button>
                </div>
            </div>
        </div>
        
        <!-- æ¯”èµ›é¡µé¢ -->
        <div id="gamePage" class="page-section">
            <div class="section">
                <h2>åˆ†ç»„æƒ…å†µ</h2>
                <div class="group-display">
                    <div class="group" id="groupA">
                        <h3>ç”²ç»„</h3>
                        <ul class="player-list" id="groupAList"></ul>
                    </div>
                    <div class="group" id="groupB">
                        <h3>ä¹™ç»„</h3>
                        <ul class="player-list" id="groupBList"></ul>
                    </div>
                </div>
                
                <div class="instructions">
                    <h4>æ¯”èµ›è§„åˆ™è¯´æ˜</h4>
                    <ul>
                        <li>æ¯”èµ›å…±è¿›è¡Œå…­è½®ï¼Œæ¯ä½é€‰æ‰‹ä¾æ¬¡ååº„ä¸€æ¬¡</li>
                        <li>æ¯è½®æ¯”èµ›åï¼Œè¯·æ ¹æ®é€‰æ‰‹è¡¨ç°æ’åï¼ˆ1-6åï¼‰</li>
                        <li><strong>è®¡åˆ†è§„åˆ™ï¼š</strong>
                            <ol>
                                <li>ç”²ç»„é€‰æ‰‹è·å¾—ä¸€ã€äºŒã€ä¸‰å â†’ ç”²ç»„å¾—8åˆ†</li>
                                <li>ç”²ç»„é€‰æ‰‹è·å¾—ç¬¬ä¸€åï¼Œä¸”ä¹™ç»„æœ‰ä¸¤äººè·å¾—ç¬¬äº”ã€å…­å â†’ ç”²ç»„å¾—5åˆ†</li>
                                <li>ç”²ç»„é€‰æ‰‹è·å¾—ç¬¬ä¸€åï¼Œä¸”ä¹™ç»„æœ‰ä¸€äººè·å¾—ç¬¬å…­å â†’ ç”²ç»„å¾—3åˆ†</li>
                                <li>ç”²ç»„é€‰æ‰‹è·å¾—ç¬¬ä¸€åï¼Œä¸”ç”²ç»„æœ‰ä¸€äººè·å¾—ç¬¬å…­å â†’ ç”²ç»„å¾—1åˆ†</li>
                                <li class="rule-highlight">ç”²ç»„é€‰æ‰‹è·å¾—ç¬¬ä¸€åï¼Œä¸”ç”²ç»„æœ‰ä¸¤äººè·å¾—ç¬¬äº”ã€å…­å â†’ ç”²ç»„å¾—0åˆ†</li>
                            </ol>
                            <div style="margin-top: 10px; font-style: italic;">ä¹™ç»„è®¡åˆ†è§„åˆ™åŒç†</div>
                        </li>
                        <li>å…­è½®ç»“æŸåï¼Œæ€»åˆ†é«˜çš„ç»„è·èƒœ</li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <h2>è¿›è¡Œæ¯”èµ›</h2>
                <div class="game-controls">
                    <div class="round-info">å½“å‰è½®æ¬¡ï¼š<span id="currentRound">1</span>/6</div>
                    <div class="button-group">
                        <button id="prevRound" disabled>ä¸Šä¸€è½®</button>
                        <button id="nextRound">ä¸‹ä¸€è½®</button>
                        <button id="submitRound">æäº¤æœ¬è½®æ’å</button>
                    </div>
                </div>
                
                <div class="ranking-input">
                    <h3>æœ¬è½®é€‰æ‰‹æ’åï¼ˆä»ç¬¬1ååˆ°ç¬¬6åï¼‰</h3>
                    <div id="rankingInputs"></div>
                </div>
                
                <div class="mobile-nav-hint">
                    <div class="icon">ğŸ“Š</div>
                    <div>æäº¤æ’ååï¼Œå¯åœ¨"ç»Ÿè®¡"é¡µé¢æŸ¥çœ‹è¯¦ç»†æ•°æ®</div>
                </div>
            </div>
            
            <!-- ä¿å­˜å½“å‰æ¯”èµ› -->
            <div class="section save-current-game">
                <h3>ä¿å­˜å½“å‰æ¯”èµ›</h3>
                <p>ä¿å­˜å½“å‰æ¯”èµ›è¿›åº¦ï¼Œä»¥ä¾¿ä»¥åç»§ç»­æˆ–æŸ¥çœ‹ã€‚</p>
                <div class="save-form">
                    <input type="text" id="saveName" class="save-input" placeholder="è¾“å…¥æ¯”èµ›åç§°ï¼ˆä¾‹å¦‚ï¼š2023å¹´ç¬¬ä¸€åœºæ¯”èµ›ï¼‰">
                    <button id="saveGame" class="save-button">ä¿å­˜æ¯”èµ›</button>
                </div>
                <div id="saveMessage" style="margin-top: 10px; font-size: 0.9rem;"></div>
            </div>
        </div>
        
        <!-- ç»Ÿè®¡é¡µé¢ -->
        <div id="statsPage" class="page-section">
            <div class="section">
                <h2>æœ¬è½®ç»Ÿè®¡</h2>
                <div class="round-summary">
                    <h3>ç¬¬<span id="summaryRound">1</span>è½®ç»“æœ</h3>
                    
                    <div class="round-score-display">
                        <div class="team-score team-a">
                            <h4>ç”²ç»„</h4>
                            <div class="score" id="roundScoreA">0</div>
                            <div>æœ¬è½®å¾—åˆ†</div>
                        </div>
                        <div class="vs">VS</div>
                        <div class="team-score team-b">
                            <h4>ä¹™ç»„</h4>
                            <div class="score" id="roundScoreB">0</div>
                            <div>æœ¬è½®å¾—åˆ†</div>
                        </div>
                    </div>
                    
                    <div class="summary-content">
                        <div class="summary-item">
                            <h4>æœ¬è½®æ’å</h4>
                            <table class="score-table">
                                <thead>
                                    <tr>
                                        <th>åæ¬¡</th>
                                        <th>é€‰æ‰‹</th>
                                        <th>ç»„åˆ«</th>
                                    </tr>
                                </thead>
                                <tbody id="roundRankingBody">
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="summary-item">
                            <h4>æœ¬è½®ç¬¬ä¸€å</h4>
                            <div style="text-align: center; padding: 15px;">
                                <div style="font-size: 28px; font-weight: bold; color: #e74c3c;" id="firstPlacePlayer">-</div>
                                <div style="margin-top: 8px;">ç»„åˆ«ï¼š<span id="firstPlaceGroup">-</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="total-score" style="margin-top: 15px;">
                        å½“å‰æ€»å¾—åˆ†ï¼šç”²ç»„ <span id="currentTotalA">0</span> : <span id="currentTotalB">0</span> ä¹™ç»„
                    </div>
                </div>
            </div>
            
            <div class="section">
                <!-- æ‰€æœ‰è½®æ¬¡æ¯”èµ›ç»Ÿè®¡ -->
                <div class="all-rounds-stats">
                    <h2>æ‰€æœ‰è½®æ¬¡æ¯”èµ›ç»Ÿè®¡</h2>
                    <div class="score-card">
                        <div style="overflow-x: auto;">
                            <table class="all-rounds-table">
                                <thead>
                                    <tr id="allRoundsHeader">
                                        <th>é€‰æ‰‹/è½®æ¬¡</th>
                                        <!-- è¡¨å¤´å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                    </tr>
                                </thead>
                                <tbody id="allRoundsBody">
                                    <!-- è¡¨æ ¼å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- ç»Ÿè®¡æ•°æ®æ‘˜è¦ -->
                <div class="stats-summary">
                    <div class="stats-item">
                        <h4>ç»„åˆ«ç»Ÿè®¡</h4>
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-value" id="teamAScore">0</div>
                                <div class="stat-label">ç”²ç»„æ€»å¾—åˆ†</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value" id="teamBScore">0</div>
                                <div class="stat-label">ä¹™ç»„æ€»å¾—åˆ†</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value" id="teamAFirst">0</div>
                                <div class="stat-label">ç”²ç»„ç¬¬ä¸€åæ¬¡æ•°</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value" id="teamBFirst">0</div>
                                <div class="stat-label">ä¹™ç»„ç¬¬ä¸€åæ¬¡æ•°</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats-item">
                        <h4>é€‰æ‰‹è¡¨ç°</h4>
                        <div id="playerPerformanceStats">
                            <!-- é€‰æ‰‹è¡¨ç°ç»Ÿè®¡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            <div style="text-align: center; padding: 20px; color: #95a5a6;">
                                æš‚æ— æ•°æ®ï¼Œè¯·å¼€å§‹æ¯”èµ›
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- è¡ŒåŠ¨æŒ‰é’® -->
                <div class="action-buttons">
                    <button id="continueGame" class="action-button">ç»§ç»­æ¯”èµ›</button>
                    <button id="viewCharts" class="action-button secondary">æŸ¥çœ‹å¯è§†åŒ–å›¾è¡¨</button>
                    <button id="saveCurrent" class="action-button secondary">ä¿å­˜å½“å‰æ¯”èµ›</button>
                </div>
            </div>
        </div>
        
        <!-- å¯è§†åŒ–å›¾è¡¨é¡µé¢ -->
        <div id="visualizationPage" class="page-section">
            <div class="section">
                <h2>æ•°æ®å¯è§†åŒ–</h2>
                
                <div class="chart-row">
                    <div class="chart-item">
                        <h3>ä¸¤ç»„ç´¯è®¡å¾—åˆ†èµ°åŠ¿</h3>
                        <canvas id="scoreChart"></canvas>
                    </div>
                    <div class="chart-item">
                        <h3>ä¸ªäººå¹³å‡æ’å</h3>
                        <canvas id="rankingChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-row">
                    <div class="chart-item">
                        <h3>ç»„åˆ«å¾—åˆ†åˆ†å¸ƒ</h3>
                        <canvas id="teamScoreChart"></canvas>
                    </div>
                    <div class="chart-item">
                        <h3>ä¸ªäººç¬¬ä¸€åæ¬¡æ•°ç»Ÿè®¡</h3>
                        <canvas id="firstPlaceChart"></canvas>
                    </div>
                </div>
                
                <!-- è¿”å›æŒ‰é’® -->
                <div class="action-buttons">
                    <button id="backToStats" class="action-button secondary">è¿”å›ç»Ÿè®¡é¡µé¢</button>
                </div>
            </div>
        </div>
        
        <!-- æœ€ç»ˆç»“æœé¡µé¢ -->
        <div id="resultsPage" class="page-section">
            <div class="section">
                <h2>æœ€ç»ˆæ¯”èµ›ç»“æœ</h2>
                
                <div class="results">
                    <div class="score-card">
                        <h3>æ¯è½®ç§¯åˆ†ç»Ÿè®¡</h3>
                        <table class="score-table" id="roundScores">
                            <thead>
                                <tr>
                                    <th>è½®æ¬¡</th>
                                    <th>ç”²ç»„å¾—åˆ†</th>
                                    <th>ä¹™ç»„å¾—åˆ†</th>
                                    <th>æœ¬è½®ç¬¬ä¸€å</th>
                                </tr>
                            </thead>
                            <tbody id="roundScoresBody">
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="score-card">
                        <h3>ä¸ªäººæ’åç»Ÿè®¡</h3>
                        <table class="score-table" id="playerStats">
                            <thead>
                                <tr>
                                    <th>é€‰æ‰‹</th>
                                    <th>ç»„åˆ«</th>
                                    <th>ç¬¬ä¸€åæ¬¡æ•°</th>
                                    <th>å¹³å‡æ’å</th>
                                </tr>
                            </thead>
                            <tbody id="playerStatsBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="total-score">
                    æœ€ç»ˆå¾—åˆ†ï¼šç”²ç»„ <span id="totalScoreA">0</span> : <span id="totalScoreB">0</span> ä¹™ç»„
                    <div id="winnerMessage" style="font-size: 1.2rem; margin-top: 10px;"></div>
                </div>
                
                <!-- ä¿å­˜æ¯”èµ›æŒ‰é’® -->
                <div class="action-buttons">
                    <button id="saveFinalResult" class="action-button">ä¿å­˜æ¯”èµ›ç»“æœ</button>
                    <button id="backToGameFromResults" class="action-button secondary">è¿”å›æ¯”èµ›</button>
                </div>
            </div>
        </div>
        
        <!-- å†å²è®°å½•é¡µé¢ -->
        <div id="historyPage" class="page-section">
            <div class="section">
                <h2>å†å²è®°å½•</h2>
                <p>æŸ¥çœ‹ä¹‹å‰ä¿å­˜çš„æ¯”èµ›è®°å½•ã€‚ç‚¹å‡»è®°å½•å¯æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥åŠ è½½è®°å½•æˆ–åˆ é™¤è®°å½•ã€‚</p>
                
                <div class="history-controls">
                    <div class="button-group">
                        <button id="refreshHistory">åˆ·æ–°åˆ—è¡¨</button>
                        <button id="clearAllHistory" class="reset">æ¸…ç©ºæ‰€æœ‰è®°å½•</button>
                    </div>
                    <div style="font-size: 0.9rem; color: #7f8c8d;">
                        å…± <span id="historyCount">0</span> æ¡è®°å½•
                    </div>
                </div>
                
                <div class="history-list" id="historyList">
                    <!-- å†å²è®°å½•å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    <div class="no-history">
                        <p>æš‚æ— å†å²è®°å½•</p>
                        <p>å¼€å§‹æ¯”èµ›å¹¶ä¿å­˜åï¼Œè®°å½•ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                    </div>
                </div>
                
                <div class="history-details" id="historyDetails" style="display: none;">
                    <h3>æ¯”èµ›è¯¦æƒ…</h3>
                    <div id="historyDetailContent">
                        <!-- è¯¦æƒ…å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="action-buttons" style="margin-top: 15px;">
                        <button id="loadSelectedHistory" class="action-button">åŠ è½½æ­¤è®°å½•</button>
                        <button id="deleteSelectedHistory" class="action-button secondary">åˆ é™¤æ­¤è®°å½•</button>
                        <button id="closeHistoryDetails" class="action-button secondary">å…³é—­è¯¦æƒ…</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            players: [],
            groups: {
                A: [],
                B: []
            },
            currentRound: 1,
            rankings: {}, // å­˜å‚¨æ¯è½®æ’å {round: {1: player, 2: player, ...}}
            scores: {
                A: Array(6).fill(0),
                B: Array(6).fill(0)
            },
            playerStats: {}, // å­˜å‚¨æ¯ä¸ªé€‰æ‰‹çš„ç¬¬ä¸€åæ¬¡æ•°å’Œæ’åæ€»å’Œ
            gameId: null, // å½“å‰æ¸¸æˆID
            gameName: '', // å½“å‰æ¸¸æˆåç§°
            createdAt: null, // åˆ›å»ºæ—¶é—´
            updatedAt: null // æœ€åæ›´æ–°æ—¶é—´
        };
        
        // DOMå…ƒç´ 
        const startGameBtn = document.getElementById('startGame');
        const resetAllBtn = document.getElementById('resetAll');
        const prevRoundBtn = document.getElementById('prevRound');
        const nextRoundBtn = document.getElementById('nextRound');
        const submitRoundBtn = document.getElementById('submitRound');
        const continueGameBtn = document.getElementById('continueGame');
        const viewChartsBtn = document.getElementById('viewCharts');
        const backToStatsBtn = document.getElementById('backToStats');
        const backToGameBtn = document.getElementById('backToGameFromResults');
        const viewHistoryBtn = document.getElementById('viewHistory');
        const saveGameBtn = document.getElementById('saveGame');
        const saveCurrentBtn = document.getElementById('saveCurrent');
        const saveFinalResultBtn = document.getElementById('saveFinalResult');
        const refreshHistoryBtn = document.getElementById('refreshHistory');
        const clearAllHistoryBtn = document.getElementById('clearAllHistory');
        const loadSelectedHistoryBtn = document.getElementById('loadSelectedHistory');
        const deleteSelectedHistoryBtn = document.getElementById('deleteSelectedHistory');
        const closeHistoryDetailsBtn = document.getElementById('closeHistoryDetails');
        
        // ç§»åŠ¨ç«¯æ ‡ç­¾é¡µ
        const mobileTabs = document.querySelectorAll('.mobile-tab');
        const pageSections = document.querySelectorAll('.page-section');
        
        // å›¾è¡¨å®ä¾‹
        let scoreChart = null;
        let rankingChart = null;
        let teamScoreChart = null;
        let firstPlaceChart = null;
        
        // å½“å‰é€‰ä¸­çš„å†å²è®°å½•ID
        let selectedHistoryId = null;
        
        // åˆå§‹åŒ–
        function initGame() {
            // è·å–é€‰æ‰‹å§“å
            gameState.players = [];
            gameState.groups.A = [];
            gameState.groups.B = [];
            
            // è·å–ç”²ç»„é€‰æ‰‹
            for (let i = 1; i <= 3; i++) {
                const playerName = document.getElementById(`player${i}`).value.trim();
                if (playerName) {
                    gameState.players.push(playerName);
                    gameState.groups.A.push(playerName);
                    // åˆå§‹åŒ–é€‰æ‰‹ç»Ÿè®¡
                    gameState.playerStats[playerName] = {
                        group: 'A',
                        firstPlaceCount: 0,
                        rankSum: 0,
                        ranks: Array(6).fill('-')
                    };
                }
            }
            
            // è·å–ä¹™ç»„é€‰æ‰‹
            for (let i = 4; i <= 6; i++) {
                const playerName = document.getElementById(`player${i}`).value.trim();
                if (playerName) {
                    gameState.players.push(playerName);
                    gameState.groups.B.push(playerName);
                    // åˆå§‹åŒ–é€‰æ‰‹ç»Ÿè®¡
                    gameState.playerStats[playerName] = {
                        group: 'B',
                        firstPlaceCount: 0,
                        rankSum: 0,
                        ranks: Array(6).fill('-')
                    };
                }
            }
            
            if (gameState.players.length !== 6) {
                alert('è¯·å¡«å†™æ‰€æœ‰6åé€‰æ‰‹çš„å§“åï¼');
                return false;
            }
            
            // ç”Ÿæˆæ–°çš„æ¸¸æˆID
            gameState.gameId = generateGameId();
            gameState.createdAt = new Date().toISOString();
            gameState.updatedAt = gameState.createdAt;
            
            return true;
        }
        
        // ç”Ÿæˆæ¸¸æˆID
        function generateGameId() {
            return 'game_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // æ˜¾ç¤ºåˆ†ç»„
        function displayGroups() {
            const groupAList = document.getElementById('groupAList');
            const groupBList = document.getElementById('groupBList');
            
            groupAList.innerHTML = '';
            groupBList.innerHTML = '';
            
            gameState.groups.A.forEach(player => {
                const li = document.createElement('li');
                li.textContent = player;
                groupAList.appendChild(li);
            });
            
            gameState.groups.B.forEach(player => {
                const li = document.createElement('li');
                li.textContent = player;
                groupBList.appendChild(li);
            });
            
            // åˆ‡æ¢åˆ°æ¸¸æˆé¡µé¢
            switchPage('game');
            
            // åˆå§‹åŒ–æ’åè¾“å…¥
            initRankingInput();
            updateGameControls();
        }
        
        // åˆå§‹åŒ–æ’åè¾“å…¥
        function initRankingInput() {
            const rankingInputs = document.getElementById('rankingInputs');
            rankingInputs.innerHTML = '';
            
            // åˆ›å»º6ä¸ªæ’åè¾“å…¥è¡Œ
            for (let rank = 1; rank <= 6; rank++) {
                const row = document.createElement('div');
                row.className = 'ranking-row';
                
                const label = document.createElement('div');
                label.className = 'rank-label';
                label.textContent = `ç¬¬${rank}åï¼š`;
                
                const select = document.createElement('select');
                select.id = `rank${rank}`;
                
                // æ·»åŠ é»˜è®¤é€‰é¡¹
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = `è¯·é€‰æ‹©ç¬¬${rank}åé€‰æ‰‹`;
                select.appendChild(defaultOption);
                
                // æ·»åŠ é€‰æ‰‹é€‰é¡¹
                gameState.players.forEach(player => {
                    const option = document.createElement('option');
                    option.value = player;
                    option.textContent = player;
                    select.appendChild(option);
                });
                
                // å¦‚æœå·²æœ‰æœ¬è½®æ’åï¼Œåˆ™é€‰ä¸­
                if (gameState.rankings[gameState.currentRound] && 
                    gameState.rankings[gameState.currentRound][rank]) {
                    select.value = gameState.rankings[gameState.currentRound][rank];
                }
                
                row.appendChild(label);
                row.appendChild(select);
                rankingInputs.appendChild(row);
            }
            
            // æ›´æ–°å½“å‰è½®æ¬¡æ˜¾ç¤º
            document.getElementById('currentRound').textContent = gameState.currentRound;
        }
        
        // æ›´æ–°æ¸¸æˆæ§åˆ¶æŒ‰é’®çŠ¶æ€
        function updateGameControls() {
            prevRoundBtn.disabled = gameState.currentRound === 1;
            nextRoundBtn.disabled = gameState.currentRound === 6;
            
            // å¦‚æœå½“å‰è½®æ¬¡å·²æäº¤æ’åï¼Œåˆ™ç¦ç”¨æ’åè¾“å…¥
            const isSubmitted = gameState.rankings[gameState.currentRound];
            const selects = document.querySelectorAll('.ranking-row select');
            selects.forEach(select => {
                select.disabled = isSubmitted;
            });
            
            submitRoundBtn.disabled = isSubmitted;
            submitRoundBtn.textContent = isSubmitted ? 'å·²æäº¤' : 'æäº¤æœ¬è½®æ’å';
            
            // å¦‚æœæ‰€æœ‰è½®æ¬¡éƒ½å®Œæˆï¼Œæ˜¾ç¤ºç»“æœ
            if (gameState.currentRound === 6 && isSubmitted) {
                calculateFinalResults();
                switchPage('results');
            }
        }
        
        // æäº¤æœ¬è½®æ’å
        function submitRoundRankings() {
            const round = gameState.currentRound;
            const ranking = {};
            let isValid = true;
            const selectedPlayers = new Set();
            
            // æ£€æŸ¥æ¯ä¸ªæ’åæ˜¯å¦å·²é€‰æ‹©ä¸”ä¸é‡å¤
            for (let rank = 1; rank <= 6; rank++) {
                const select = document.getElementById(`rank${rank}`);
                const player = select.value;
                
                if (!player) {
                    alert(`è¯·é€‰æ‹©ç¬¬${rank}åé€‰æ‰‹ï¼`);
                    isValid = false;
                    break;
                }
                
                if (selectedPlayers.has(player)) {
                    alert(`é€‰æ‰‹"${player}"å·²è¢«é€‰æ‹©ï¼Œè¯·å‹¿é‡å¤é€‰æ‹©ï¼`);
                    isValid = false;
                    break;
                }
                
                ranking[rank] = player;
                selectedPlayers.add(player);
            }
            
            if (!isValid) return;
            
            // ä¿å­˜æ’å
            gameState.rankings[round] = ranking;
            
            // æ›´æ–°é€‰æ‰‹ç»Ÿè®¡
            Object.keys(ranking).forEach(rank => {
                const player = ranking[rank];
                const rankNum = parseInt(rank);
                gameState.playerStats[player].rankSum += rankNum;
                gameState.playerStats[player].ranks[round - 1] = rankNum;
                
                if (rankNum === 1) {
                    gameState.playerStats[player].firstPlaceCount++;
                }
            });
            
            // è®¡ç®—æœ¬è½®å¾—åˆ†
            calculateRoundScore(round);
            
            // æ›´æ–°æ¸¸æˆæ—¶é—´
            gameState.updatedAt = new Date().toISOString();
            
            // æ˜¾ç¤ºæœ¬è½®ç»Ÿè®¡
            showRoundSummary(round);
            
            // æ›´æ–°æ‰€æœ‰ç»Ÿè®¡æ•°æ®
            updateAllStats();
            
            // æ›´æ–°æ‰€æœ‰å›¾è¡¨
            updateAllCharts();
            
            // æ›´æ–°æ§åˆ¶æŒ‰é’®
            updateGameControls();
            
            // åˆ‡æ¢åˆ°ç»Ÿè®¡é¡µé¢
            switchPage('stats');
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            alert(`ç¬¬${round}è½®æ’åå·²æäº¤ï¼å·²åˆ‡æ¢åˆ°ç»Ÿè®¡é¡µé¢ã€‚`);
            
            // è‡ªåŠ¨ä¿å­˜å½“å‰æ¸¸æˆ
            autoSaveGame();
        }
        
        // è®¡ç®—å•è½®å¾—åˆ† - æ ¹æ®ä¿®æ”¹åçš„è§„åˆ™
        function calculateRoundScore(round) {
            const ranking = gameState.rankings[round];
            
            // æ‰¾å‡ºç¬¬ä¸€å
            const firstPlacePlayer = ranking[1];
            const firstPlaceGroup = gameState.playerStats[firstPlacePlayer].group;
            
            // æ‰¾å‡ºç¬¬å…­å
            const sixthPlacePlayer = ranking[6];
            const sixthPlaceGroup = gameState.playerStats[sixthPlacePlayer].group;
            
            // æ‰¾å‡ºç¬¬äº”å
            const fifthPlacePlayer = ranking[5];
            const fifthPlaceGroup = gameState.playerStats[fifthPlacePlayer].group;
            
            // æ‰¾å‡ºç¬¬äºŒåå’Œç¬¬ä¸‰å
            const secondPlacePlayer = ranking[2];
            const secondPlaceGroup = gameState.playerStats[secondPlacePlayer].group;
            const thirdPlacePlayer = ranking[3];
            const thirdPlaceGroup = gameState.playerStats[thirdPlacePlayer].group;
            
            let score = 0;
            
            // æ£€æŸ¥æ˜¯å¦åŒ…æ½å‰ä¸‰å
            const isSweepTopThree = firstPlaceGroup === secondPlaceGroup && 
                                   firstPlaceGroup === thirdPlaceGroup;
            
            if (isSweepTopThree) {
                score = 8;
            } else {
                // æ£€æŸ¥åä¸¤åæ˜¯å¦éƒ½æ˜¯å¦ä¸€ç»„
                const otherGroup = firstPlaceGroup === 'A' ? 'B' : 'A';
                
                // æ ¹æ®æ–°è§„åˆ™åˆ¤æ–­å¾—åˆ†
                if (fifthPlaceGroup === otherGroup && sixthPlaceGroup === otherGroup) {
                    // ç¬¬äº”ã€å…­åéƒ½æ˜¯å¦ä¸€ç»„
                    score = 5;
                } else if (sixthPlaceGroup === otherGroup) {
                    // åªæœ‰ç¬¬å…­åæ˜¯å¦ä¸€ç»„
                    score = 3;
                } else if (sixthPlaceGroup === firstPlaceGroup && fifthPlaceGroup !== firstPlaceGroup) {
                    // ç¬¬å…­åæ˜¯åŒç»„ï¼Œä½†ç¬¬äº”åä¸æ˜¯åŒç»„
                    score = 1;
                } else if (fifthPlaceGroup === firstPlaceGroup && sixthPlaceGroup === firstPlaceGroup) {
                    // ç¬¬äº”ã€å…­åéƒ½æ˜¯åŒç»„ - æ–°å¢è§„åˆ™ï¼šå¾—0åˆ†
                    score = 0;
                } else if (sixthPlaceGroup === firstPlaceGroup) {
                    // ç¬¬å…­åæ˜¯åŒç»„ï¼Œä½†ç¬¬äº”åæƒ…å†µæœªæ˜ç¡® - é»˜è®¤ä¸º1åˆ†ï¼ˆä¸åŸè§„åˆ™ä¿æŒä¸€è‡´ï¼‰
                    score = 1;
                }
            }
            
            // è®°å½•å¾—åˆ†
            if (firstPlaceGroup === 'A') {
                gameState.scores.A[round - 1] = score;
                gameState.scores.B[round - 1] = 0;
            } else {
                gameState.scores.B[round - 1] = score;
                gameState.scores.A[round - 1] = 0;
            }
            
            // è®°å½•å¾—åˆ†è§„åˆ™è¯´æ˜ï¼ˆç”¨äºè°ƒè¯•ï¼‰
            gameState.rankings[round].scoreRule = getScoreRuleDescription(round);
        }
        
        // è·å–å¾—åˆ†è§„åˆ™è¯´æ˜
        function getScoreRuleDescription(round) {
            const ranking = gameState.rankings[round];
            
            // æ‰¾å‡ºç¬¬ä¸€å
            const firstPlacePlayer = ranking[1];
            const firstPlaceGroup = gameState.playerStats[firstPlacePlayer].group;
            
            // æ‰¾å‡ºç¬¬å…­å
            const sixthPlacePlayer = ranking[6];
            const sixthPlaceGroup = gameState.playerStats[sixthPlacePlayer].group;
            
            // æ‰¾å‡ºç¬¬äº”å
            const fifthPlacePlayer = ranking[5];
            const fifthPlaceGroup = gameState.playerStats[fifthPlacePlayer].group;
            
            // æ‰¾å‡ºç¬¬äºŒåå’Œç¬¬ä¸‰å
            const secondPlacePlayer = ranking[2];
            const secondPlaceGroup = gameState.playerStats[secondPlacePlayer].group;
            const thirdPlacePlayer = ranking[3];
            const thirdPlaceGroup = gameState.playerStats[thirdPlacePlayer].group;
            
            const isSweepTopThree = firstPlaceGroup === secondPlaceGroup && 
                                   firstPlaceGroup === thirdPlaceGroup;
            
            if (isSweepTopThree) {
                return `${firstPlaceGroup === 'A' ? 'ç”²' : 'ä¹™'}ç»„åŒ…æ½å‰ä¸‰åï¼Œå¾—8åˆ†`;
            }
            
            const otherGroup = firstPlaceGroup === 'A' ? 'B' : 'A';
            
            if (fifthPlaceGroup === otherGroup && sixthPlaceGroup === otherGroup) {
                return `${firstPlaceGroup === 'A' ? 'ç”²' : 'ä¹™'}ç»„ç¬¬ä¸€åï¼Œ${otherGroup === 'A' ? 'ç”²' : 'ä¹™'}ç»„ç¬¬äº”ã€å…­åï¼Œå¾—5åˆ†`;
            } else if (sixthPlaceGroup === otherGroup) {
                return `${firstPlaceGroup === 'A' ? 'ç”²' : 'ä¹™'}ç»„ç¬¬ä¸€åï¼Œ${otherGroup === 'A' ? 'ç”²' : 'ä¹™'}ç»„ç¬¬å…­åï¼Œå¾—3åˆ†`;
            } else if (sixthPlaceGroup === firstPlaceGroup && fifthPlaceGroup !== firstPlaceGroup) {
                return `${firstPlaceGroup === 'A' ? 'ç”²' : 'ä¹™'}ç»„ç¬¬ä¸€åï¼Œ${firstPlaceGroup === 'A' ? 'ç”²' : 'ä¹™'}ç»„ç¬¬å…­åï¼Œ${otherGroup === 'A' ? 'ç”²' : 'ä¹™'}ç»„ç¬¬äº”åï¼Œå¾—1åˆ†`;
            } else if (fifthPlaceGroup === firstPlaceGroup && sixthPlaceGroup === firstPlaceGroup) {
                return `${firstPlaceGroup === 'A' ? 'ç”²' : 'ä¹™'}ç»„ç¬¬ä¸€åï¼Œ${firstPlaceGroup === 'A' ? 'ç”²' : 'ä¹™'}ç»„ç¬¬äº”ã€å…­åï¼Œå¾—0åˆ†`;
            } else if (sixthPlaceGroup === firstPlaceGroup) {
                return `${firstPlaceGroup === 'A' ? 'ç”²' : 'ä¹™'}ç»„ç¬¬ä¸€åï¼Œ${firstPlaceGroup === 'A' ? 'ç”²' : 'ä¹™'}ç»„ç¬¬å…­åï¼Œå¾—1åˆ†`;
            }
            
            return 'æœªçŸ¥è§„åˆ™';
        }
        
        // æ˜¾ç¤ºæœ¬è½®ç»Ÿè®¡
        function showRoundSummary(round) {
            document.getElementById('summaryRound').textContent = round;
            
            // æ˜¾ç¤ºæœ¬è½®å¾—åˆ†
            document.getElementById('roundScoreA').textContent = gameState.scores.A[round - 1];
            document.getElementById('roundScoreB').textContent = gameState.scores.B[round - 1];
            
            // è®¡ç®—å½“å‰æ€»å¾—åˆ†
            const totalScoreA = gameState.scores.A.slice(0, round).reduce((sum, score) => sum + score, 0);
            const totalScoreB = gameState.scores.B.slice(0, round).reduce((sum, score) => sum + score, 0);
            
            document.getElementById('currentTotalA').textContent = totalScoreA;
            document.getElementById('currentTotalB').textContent = totalScoreB;
            
            // æ˜¾ç¤ºæœ¬è½®æ’å
            const ranking = gameState.rankings[round];
            const tbody = document.getElementById('roundRankingBody');
            tbody.innerHTML = '';
            
            for (let rank = 1; rank <= 6; rank++) {
                const player = ranking[rank];
                const group = gameState.playerStats[player].group;
                
                const row = document.createElement('tr');
                
                const rankCell = document.createElement('td');
                rankCell.textContent = rank;
                if (rank === 1) {
                    rankCell.className = 'first-place';
                } else if (rank === 5 || rank === 6) {
                    rankCell.className = 'last-place';
                }
                row.appendChild(rankCell);
                
                const playerCell = document.createElement('td');
                playerCell.textContent = player;
                playerCell.className = group === 'A' ? 'group-a-player' : 'group-b-player';
                row.appendChild(playerCell);
                
                const groupCell = document.createElement('td');
                groupCell.textContent = group === 'A' ? 'ç”²ç»„' : 'ä¹™ç»„';
                row.appendChild(groupCell);
                
                tbody.appendChild(row);
            }
            
            // æ˜¾ç¤ºç¬¬ä¸€åä¿¡æ¯
            document.getElementById('firstPlacePlayer').textContent = ranking[1];
            document.getElementById('firstPlaceGroup').textContent = 
                gameState.playerStats[ranking[1]].group === 'A' ? 'ç”²ç»„' : 'ä¹™ç»„';
        }
        
        // æ›´æ–°æ‰€æœ‰ç»Ÿè®¡æ•°æ®
        function updateAllStats() {
            // æ›´æ–°ç»„åˆ«ç»Ÿè®¡
            const totalScoreA = gameState.scores.A.slice(0, gameState.currentRound).reduce((sum, score) => sum + score, 0);
            const totalScoreB = gameState.scores.B.slice(0, gameState.currentRound).reduce((sum, score) => sum + score, 0);
            
            document.getElementById('teamAScore').textContent = totalScoreA;
            document.getElementById('teamBScore').textContent = totalScoreB;
            
            // è®¡ç®—å„ç»„ç¬¬ä¸€åæ¬¡æ•°
            const firstPlaceCountA = gameState.groups.A.reduce((sum, player) => 
                sum + gameState.playerStats[player].firstPlaceCount, 0);
            const firstPlaceCountB = gameState.groups.B.reduce((sum, player) => 
                sum + gameState.playerStats[player].firstPlaceCount, 0);
            
            document.getElementById('teamAFirst').textContent = firstPlaceCountA;
            document.getElementById('teamBFirst').textContent = firstPlaceCountB;
            
            // æ›´æ–°æ‰€æœ‰è½®æ¬¡æ¯”èµ›ç»Ÿè®¡è¡¨æ ¼
            updateAllRoundsTable();
            
            // æ›´æ–°é€‰æ‰‹è¡¨ç°ç»Ÿè®¡
            updatePlayerPerformanceStats();
        }
        
        // æ›´æ–°æ‰€æœ‰è½®æ¬¡æ¯”èµ›ç»Ÿè®¡è¡¨æ ¼
        function updateAllRoundsTable() {
            const headerRow = document.getElementById('allRoundsHeader');
            const tbody = document.getElementById('allRoundsBody');
            
            // æ¸…ç©ºè¡¨æ ¼
            headerRow.innerHTML = '<th>é€‰æ‰‹/è½®æ¬¡</th>';
            tbody.innerHTML = '';
            
            // åˆ›å»ºè¡¨å¤´
            for (let round = 1; round <= 6; round++) {
                const th = document.createElement('th');
                th.textContent = `ç¬¬${round}è½®`;
                headerRow.appendChild(th);
            }
            
            // ä¸ºæ¯ä¸ªé€‰æ‰‹åˆ›å»ºä¸€è¡Œ
            gameState.players.forEach(player => {
                const row = document.createElement('tr');
                
                // é€‰æ‰‹å§“åå•å…ƒæ ¼
                const nameCell = document.createElement('td');
                nameCell.className = 'player-name-cell';
                nameCell.textContent = player;
                nameCell.classList.add(gameState.playerStats[player].group === 'A' ? 'group-a-player' : 'group-b-player');
                row.appendChild(nameCell);
                
                // æ¯è½®æ’åå•å…ƒæ ¼
                for (let round = 1; round <= 6; round++) {
                    const rankCell = document.createElement('td');
                    const rank = gameState.playerStats[player].ranks[round - 1];
                    
                    if (rank === '-') {
                        rankCell.textContent = '-';
                    } else {
                        rankCell.textContent = rank;
                        
                        // ä¸ºç¬¬ä¸€åå’Œæœ€åä¸¤åæ·»åŠ ç‰¹æ®Šæ ·å¼
                        if (rank === 1) {
                            rankCell.className = 'first-place';
                        } else if (rank === 5 || rank === 6) {
                            rankCell.className = 'last-place';
                        }
                    }
                    
                    row.appendChild(rankCell);
                }
                
                tbody.appendChild(row);
            });
        }
        
        // æ›´æ–°é€‰æ‰‹è¡¨ç°ç»Ÿè®¡
        function updatePlayerPerformanceStats() {
            const container = document.getElementById('playerPerformanceStats');
            container.innerHTML = '';
            
            // æŒ‰å¹³å‡æ’åæ’åº
            const sortedPlayers = [...gameState.players].sort((a, b) => {
                const statsA = gameState.playerStats[a];
                const statsB = gameState.playerStats[b];
                
                // åªè®¡ç®—å·²è¿›è¡Œè½®æ¬¡çš„å¹³å‡æ’å
                const roundsPlayed = gameState.currentRound;
                const avgRankA = roundsPlayed > 0 ? (statsA.rankSum / roundsPlayed) : 0;
                const avgRankB = roundsPlayed > 0 ? (statsB.rankSum / roundsPlayed) : 0;
                
                return avgRankA - avgRankB;
            });
            
            // åˆ›å»ºé€‰æ‰‹è¡¨ç°åˆ—è¡¨
            sortedPlayers.forEach((player, index) => {
                const stats = gameState.playerStats[player];
                const roundsPlayed = gameState.currentRound;
                const avgRank = roundsPlayed > 0 ? (stats.rankSum / roundsPlayed).toFixed(2) : '-';
                
                const playerDiv = document.createElement('div');
                playerDiv.style.padding = '10px';
                playerDiv.style.marginBottom = '8px';
                playerDiv.style.backgroundColor = '#f8f9fa';
                playerDiv.style.borderRadius = '5px';
                playerDiv.style.borderLeft = `4px solid ${stats.group === 'A' ? '#3498db' : '#e74c3c'}`;
                
                playerDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong style="color: ${stats.group === 'A' ? '#3498db' : '#e74c3c'};">${player}</strong>
                            <div style="font-size: 0.9rem; color: #7f8c8d;">${stats.group === 'A' ? 'ç”²ç»„' : 'ä¹™ç»„'}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.2rem; font-weight: bold;">${avgRank}</div>
                            <div style="font-size: 0.9rem; color: #7f8c8d;">å¹³å‡æ’å</div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.9rem;">
                        <div>ç¬¬ä¸€åï¼š${stats.firstPlaceCount}æ¬¡</div>
                        <div>æœ€å¥½åæ¬¡ï¼š${stats.ranks.filter(r => r !== '-').length > 0 ? Math.min(...stats.ranks.filter(r => r !== '-')) : '-'}</div>
                    </div>
                `;
                
                container.appendChild(playerDiv);
            });
        }
        
        // æ›´æ–°æ‰€æœ‰å›¾è¡¨
        function updateAllCharts() {
            updateScoreChart();
            updateRankingChart();
            updateTeamScoreChart();
            updateFirstPlaceChart();
        }
        
        // æ›´æ–°å¾—åˆ†å›¾è¡¨
        function updateScoreChart() {
            const ctx = document.getElementById('scoreChart').getContext('2d');
            
            // å¦‚æœå·²æœ‰å›¾è¡¨å®ä¾‹ï¼Œåˆ™é”€æ¯
            if (scoreChart) {
                scoreChart.destroy();
            }
            
            const labels = ['ç¬¬1è½®', 'ç¬¬2è½®', 'ç¬¬3è½®', 'ç¬¬4è½®', 'ç¬¬5è½®', 'ç¬¬6è½®'];
            const cumulativeA = [];
            const cumulativeB = [];
            
            let sumA = 0;
            let sumB = 0;
            
            for (let i = 0; i < 6; i++) {
                sumA += gameState.scores.A[i];
                sumB += gameState.scores.B[i];
                cumulativeA.push(sumA);
                cumulativeB.push(sumB);
            }
            
            scoreChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels.slice(0, gameState.currentRound),
                    datasets: [
                        {
                            label: 'ç”²ç»„ç´¯è®¡å¾—åˆ†',
                            data: cumulativeA.slice(0, gameState.currentRound),
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'ä¹™ç»„ç´¯è®¡å¾—åˆ†',
                            data: cumulativeB.slice(0, gameState.currentRound),
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ä¸¤ç»„ç´¯è®¡å¾—åˆ†èµ°åŠ¿å›¾',
                            font: {
                                size: 14
                            }
                        },
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ç´¯è®¡å¾—åˆ†'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'æ¯”èµ›è½®æ¬¡'
                            }
                        }
                    }
                }
            });
        }
        
        // æ›´æ–°æ’åå›¾è¡¨
        function updateRankingChart() {
            const ctx = document.getElementById('rankingChart').getContext('2d');
            
            // å¦‚æœå·²æœ‰å›¾è¡¨å®ä¾‹ï¼Œåˆ™é”€æ¯
            if (rankingChart) {
                rankingChart.destroy();
            }
            
            // è®¡ç®—æ¯ä¸ªé€‰æ‰‹çš„å¹³å‡æ’å
            const playerNames = [];
            const avgRanks = [];
            const colors = [];
            
            gameState.players.forEach(player => {
                const stats = gameState.playerStats[player];
                const roundsPlayed = gameState.currentRound;
                const avgRank = roundsPlayed > 0 ? (stats.rankSum / roundsPlayed) : 0;
                
                playerNames.push(player);
                avgRanks.push(avgRank);
                
                // æ ¹æ®ç»„åˆ«è®¾ç½®é¢œè‰²
                colors.push(stats.group === 'A' ? '#3498db' : '#e74c3c');
            });
            
            rankingChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: playerNames,
                    datasets: [{
                        label: 'å¹³å‡æ’å (æ•°å€¼è¶Šå°è¶Šå¥½)',
                        data: avgRanks,
                        backgroundColor: colors,
                        borderColor: colors.map(color => color.replace('0.8', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ä¸ªäººå¹³å‡æ’å',
                            font: {
                                size: 14
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            reverse: true, // æ’åè¶Šå°è¶Šå¥½ï¼Œæ‰€ä»¥åè½¬Yè½´
                            title: {
                                display: true,
                                text: 'å¹³å‡æ’å'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'é€‰æ‰‹'
                            }
                        }
                    }
                }
            });
        }
        
        // æ›´æ–°ç»„åˆ«å¾—åˆ†åˆ†å¸ƒå›¾è¡¨
        function updateTeamScoreChart() {
            const ctx = document.getElementById('teamScoreChart').getContext('2d');
            
            // å¦‚æœå·²æœ‰å›¾è¡¨å®ä¾‹ï¼Œåˆ™é”€æ¯
            if (teamScoreChart) {
                teamScoreChart.destroy();
            }
            
            // è®¡ç®—å„è½®å¾—åˆ†åˆ†å¸ƒ
            const labels = ['ç¬¬1è½®', 'ç¬¬2è½®', 'ç¬¬3è½®', 'ç¬¬4è½®', 'ç¬¬5è½®', 'ç¬¬6è½®'];
            
            teamScoreChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels.slice(0, gameState.currentRound),
                    datasets: [
                        {
                            label: 'ç”²ç»„å¾—åˆ†',
                            data: gameState.scores.A.slice(0, gameState.currentRound),
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            borderColor: '#3498db',
                            borderWidth: 1
                        },
                        {
                            label: 'ä¹™ç»„å¾—åˆ†',
                            data: gameState.scores.B.slice(0, gameState.currentRound),
                            backgroundColor: 'rgba(231, 76, 60, 0.7)',
                            borderColor: '#e74c3c',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'å„è½®å¾—åˆ†åˆ†å¸ƒ',
                            font: {
                                size: 14
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'å¾—åˆ†'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'æ¯”èµ›è½®æ¬¡'
                            }
                        }
                    }
                }
            });
        }
        
        // æ›´æ–°ç¬¬ä¸€åæ¬¡æ•°å›¾è¡¨
        function updateFirstPlaceChart() {
            const ctx = document.getElementById('firstPlaceChart').getContext('2d');
            
            // å¦‚æœå·²æœ‰å›¾è¡¨å®ä¾‹ï¼Œåˆ™é”€æ¯
            if (firstPlaceChart) {
                firstPlaceChart.destroy();
            }
            
            // è®¡ç®—æ¯ä¸ªé€‰æ‰‹çš„ç¬¬ä¸€åæ¬¡æ•°
            const playerNames = [];
            const firstPlaceCounts = [];
            const colors = [];
            
            gameState.players.forEach(player => {
                const stats = gameState.playerStats[player];
                
                playerNames.push(player);
                firstPlaceCounts.push(stats.firstPlaceCount);
                
                // æ ¹æ®ç»„åˆ«è®¾ç½®é¢œè‰²
                colors.push(stats.group === 'A' ? '#3498db' : '#e74c3c');
            });
            
            firstPlaceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: playerNames,
                    datasets: [{
                        label: 'è·å¾—ç¬¬ä¸€åæ¬¡æ•°',
                        data: firstPlaceCounts,
                        backgroundColor: colors,
                        borderColor: colors.map(color => color.replace('0.8', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ä¸ªäººç¬¬ä¸€åæ¬¡æ•°ç»Ÿè®¡',
                            font: {
                                size: 14
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ç¬¬ä¸€åæ¬¡æ•°'
                            },
                            ticks: {
                                stepSize: 1
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'é€‰æ‰‹'
                            }
                        }
                    }
                }
            });
        }
        
        // è®¡ç®—æœ€ç»ˆç»“æœ
        function calculateFinalResults() {
            // è®¡ç®—æ€»å¾—åˆ†
            const totalScoreA = gameState.scores.A.reduce((sum, score) => sum + score, 0);
            const totalScoreB = gameState.scores.B.reduce((sum, score) => sum + score, 0);
            
            // æ›´æ–°æ€»å¾—åˆ†æ˜¾ç¤º
            document.getElementById('totalScoreA').textContent = totalScoreA;
            document.getElementById('totalScoreB').textContent = totalScoreB;
            
            // åˆ¤æ–­èƒœè€…
            let winnerMessage = '';
            if (totalScoreA > totalScoreB) {
                winnerMessage = 'ç”²ç»„è·èƒœï¼';
            } else if (totalScoreB > totalScoreA) {
                winnerMessage = 'ä¹™ç»„è·èƒœï¼';
            } else {
                // è®¡ç®—ç¬¬ä¸€åæ¬¡æ•°
                const firstPlaceCountA = gameState.groups.A.reduce((sum, player) => 
                    sum + gameState.playerStats[player].firstPlaceCount, 0);
                const firstPlaceCountB = gameState.groups.B.reduce((sum, player) => 
                    sum + gameState.playerStats[player].firstPlaceCount, 0);
                
                if (firstPlaceCountA > firstPlaceCountB) {
                    winnerMessage = 'å¹³å±€ï¼ç”²ç»„è·å¾—ç¬¬ä¸€åæ¬¡æ•°æ›´å¤šï¼Œç”²ç»„è·èƒœï¼';
                } else if (firstPlaceCountB > firstPlaceCountA) {
                    winnerMessage = 'å¹³å±€ï¼ä¹™ç»„è·å¾—ç¬¬ä¸€åæ¬¡æ•°æ›´å¤šï¼Œä¹™ç»„è·èƒœï¼';
                } else {
                    winnerMessage = 'å¹³å±€ï¼éœ€åŠ èµ›ä¸€å‰¯ç‰Œå†³å®šèƒœè´Ÿï¼';
                }
            }
            
            document.getElementById('winnerMessage').textContent = winnerMessage;
            
            // æ›´æ–°æ¯è½®ç§¯åˆ†è¡¨æ ¼
            updateRoundScoresTable();
            
            // æ›´æ–°ä¸ªäººç»Ÿè®¡è¡¨æ ¼
            updatePlayerStatsTable();
            
            // æ›´æ–°æ‰€æœ‰ç»Ÿè®¡æ•°æ®
            updateAllStats();
            
            // æ›´æ–°æ‰€æœ‰å›¾è¡¨
            updateAllCharts();
        }
        
        // æ›´æ–°æ¯è½®ç§¯åˆ†è¡¨æ ¼
        function updateRoundScoresTable() {
            const tbody = document.getElementById('roundScoresBody');
            tbody.innerHTML = '';
            
            for (let round = 1; round <= 6; round++) {
                const row = document.createElement('tr');
                
                // è½®æ¬¡
                const roundCell = document.createElement('td');
                roundCell.textContent = `ç¬¬${round}è½®`;
                row.appendChild(roundCell);
                
                // ç”²ç»„å¾—åˆ†
                const scoreACell = document.createElement('td');
                scoreACell.textContent = gameState.scores.A[round - 1];
                row.appendChild(scoreACell);
                
                // ä¹™ç»„å¾—åˆ†
                const scoreBCell = document.createElement('td');
                scoreBCell.textContent = gameState.scores.B[round - 1];
                row.appendChild(scoreBCell);
                
                // æœ¬è½®ç¬¬ä¸€å
                const firstPlaceCell = document.createElement('td');
                if (gameState.rankings[round]) {
                    firstPlaceCell.textContent = gameState.rankings[round][1];
                } else {
                    firstPlaceCell.textContent = '-';
                }
                row.appendChild(firstPlaceCell);
                
                tbody.appendChild(row);
            }
        }
        
        // æ›´æ–°ä¸ªäººç»Ÿè®¡è¡¨æ ¼
        function updatePlayerStatsTable() {
            const tbody = document.getElementById('playerStatsBody');
            tbody.innerHTML = '';
            
            // æŒ‰å¹³å‡æ’åæ’åº
            const sortedPlayers = [...gameState.players].sort((a, b) => {
                const avgA = gameState.playerStats[a].rankSum / 6;
                const avgB = gameState.playerStats[b].rankSum / 6;
                return avgA - avgB;
            });
            
            sortedPlayers.forEach(player => {
                const stats = gameState.playerStats[player];
                const row = document.createElement('tr');
                
                // é€‰æ‰‹å§“å
                const nameCell = document.createElement('td');
                nameCell.textContent = player;
                row.appendChild(nameCell);
                
                // ç»„åˆ«
                const groupCell = document.createElement('td');
                groupCell.textContent = stats.group === 'A' ? 'ç”²ç»„' : 'ä¹™ç»„';
                row.appendChild(groupCell);
                
                // ç¬¬ä¸€åæ¬¡æ•°
                const firstPlaceCell = document.createElement('td');
                firstPlaceCell.textContent = stats.firstPlaceCount;
                row.appendChild(firstPlaceCell);
                
                // å¹³å‡æ’å
                const avgRankCell = document.createElement('td');
                const avgRank = (stats.rankSum / 6).toFixed(2);
                avgRankCell.textContent = avgRank;
                row.appendChild(avgRankCell);
                
                tbody.appendChild(row);
            });
        }
        
        // ä¿å­˜å½“å‰æ¸¸æˆåˆ°æœ¬åœ°å­˜å‚¨
        function saveCurrentGame() {
            const saveNameInput = document.getElementById('saveName');
            let gameName = saveNameInput.value.trim();
            
            if (!gameName) {
                // å¦‚æœæ²¡æœ‰è¾“å…¥åç§°ï¼Œä½¿ç”¨é»˜è®¤åç§°
                const date = new Date();
                gameName = `æ¯”èµ› ${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()} ${date.getHours()}:${date.getMinutes()}`;
            }
            
            gameState.gameName = gameName;
            gameState.updatedAt = new Date().toISOString();
            
            // å‡†å¤‡ä¿å­˜çš„æ•°æ®
            const gameData = {
                id: gameState.gameId,
                name: gameState.gameName,
                createdAt: gameState.createdAt,
                updatedAt: gameState.updatedAt,
                players: gameState.players,
                groups: gameState.groups,
                currentRound: gameState.currentRound,
                rankings: gameState.rankings,
                scores: gameState.scores,
                playerStats: gameState.playerStats
            };
            
            // ä¿å­˜åˆ°localStorage
            const history = getHistory();
            history[gameState.gameId] = gameData;
            localStorage.setItem('daguailuzi_history', JSON.stringify(history));
            
            // æ˜¾ç¤ºä¿å­˜æˆåŠŸæ¶ˆæ¯
            const saveMessage = document.getElementById('saveMessage');
            saveMessage.innerHTML = `<span style="color: #27ae60;">âœ“ æ¯”èµ›å·²ä¿å­˜ä¸º: "${gameName}"</span>`;
            saveMessage.style.display = 'block';
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            saveNameInput.value = '';
            
            // 3ç§’åéšè—æ¶ˆæ¯
            setTimeout(() => {
                saveMessage.style.display = 'none';
            }, 3000);
            
            // åˆ·æ–°å†å²è®°å½•åˆ—è¡¨
            refreshHistoryList();
            
            return true;
        }
        
        // è‡ªåŠ¨ä¿å­˜æ¸¸æˆ
        function autoSaveGame() {
            // åªæœ‰åœ¨æœ‰æ¸¸æˆåç§°æ—¶æ‰è‡ªåŠ¨ä¿å­˜
            if (gameState.gameName) {
                saveCurrentGame();
            }
        }
        
        // ä»æœ¬åœ°å­˜å‚¨è·å–å†å²è®°å½•
        function getHistory() {
            const historyJson = localStorage.getItem('daguailuzi_history');
            return historyJson ? JSON.parse(historyJson) : {};
        }
        
        // åˆ·æ–°å†å²è®°å½•åˆ—è¡¨
        function refreshHistoryList() {
            const history = getHistory();
            const historyList = document.getElementById('historyList');
            const historyCount = document.getElementById('historyCount');
            
            // æ¸…ç©ºåˆ—è¡¨
            historyList.innerHTML = '';
            
            // è·å–æ‰€æœ‰å†å²è®°å½•å¹¶æ’åºï¼ˆæŒ‰æ›´æ–°æ—¶é—´å€’åºï¼‰
            const historyArray = Object.values(history);
            historyArray.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
            
            // æ›´æ–°è®¡æ•°
            historyCount.textContent = historyArray.length;
            
            if (historyArray.length === 0) {
                // æ²¡æœ‰å†å²è®°å½•
                historyList.innerHTML = `
                    <div class="no-history">
                        <p>æš‚æ— å†å²è®°å½•</p>
                        <p>å¼€å§‹æ¯”èµ›å¹¶ä¿å­˜åï¼Œè®°å½•ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                    </div>
                `;
                return;
            }
            
            // æ˜¾ç¤ºå†å²è®°å½•
            historyArray.forEach(game => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.dataset.id = game.id;
                
                // è®¡ç®—æ¯”èµ›çŠ¶æ€
                const isCompleted = game.currentRound === 6 && Object.keys(game.rankings).length === 6;
                const totalScoreA = game.scores.A.reduce((sum, score) => sum + score, 0);
                const totalScoreB = game.scores.B.reduce((sum, score) => sum + score, 0);
                
                // æ ¼å¼åŒ–æ—¥æœŸ
                const updatedDate = new Date(game.updatedAt);
                const dateStr = `${updatedDate.getFullYear()}-${(updatedDate.getMonth()+1).toString().padStart(2, '0')}-${updatedDate.getDate().toString().padStart(2, '0')} ${updatedDate.getHours().toString().padStart(2, '0')}:${updatedDate.getMinutes().toString().padStart(2, '0')}`;
                
                historyItem.innerHTML = `
                    <div class="history-title">${game.name}</div>
                    <div class="history-meta">
                        <div>${dateStr}</div>
                        <div>${isCompleted ? 'å·²å®Œæˆ' : `ç¬¬${game.currentRound}è½®`}</div>
                    </div>
                    <div class="history-stats">
                        <div class="history-stat">ç”²ç»„: ${totalScoreA}åˆ†</div>
                        <div class="history-stat">ä¹™ç»„: ${totalScoreB}åˆ†</div>
                        <div class="history-stat">é€‰æ‰‹: ${game.players.length}äºº</div>
                    </div>
                `;
                
                // ç‚¹å‡»äº‹ä»¶
                historyItem.addEventListener('click', (e) => {
                    // å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®ï¼Œä¸è§¦å‘é€‰æ‹©
                    if (e.target.tagName === 'BUTTON') return;
                    
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çš„é¡¹ç›®
                    document.querySelectorAll('.history-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // æ·»åŠ æ´»åŠ¨çŠ¶æ€
                    historyItem.classList.add('active');
                    
                    // è®¾ç½®é€‰ä¸­çš„ID
                    selectedHistoryId = game.id;
                    
                    // æ˜¾ç¤ºè¯¦æƒ…
                    showHistoryDetails(game);
                });
                
                historyList.appendChild(historyItem);
            });
        }
        
        // æ˜¾ç¤ºå†å²è®°å½•è¯¦æƒ…
        function showHistoryDetails(game) {
            const historyDetails = document.getElementById('historyDetails');
            const detailContent = document.getElementById('historyDetailContent');
            
            // è®¡ç®—æ¯”èµ›çŠ¶æ€
            const isCompleted = game.currentRound === 6 && Object.keys(game.rankings).length === 6;
            const totalScoreA = game.scores.A.reduce((sum, score) => sum + score, 0);
            const totalScoreB = game.scores.B.reduce((sum, score) => sum + score, 0);
            const winner = totalScoreA > totalScoreB ? 'ç”²ç»„' : totalScoreB > totalScoreA ? 'ä¹™ç»„' : 'å¹³å±€';
            
            // æ ¼å¼åŒ–æ—¥æœŸ
            const createdDate = new Date(game.createdAt);
            const updatedDate = new Date(game.updatedAt);
            const createdStr = `${createdDate.getFullYear()}-${(createdDate.getMonth()+1).toString().padStart(2, '0')}-${createdDate.getDate().toString().padStart(2, '0')} ${createdDate.getHours().toString().padStart(2, '0')}:${createdDate.getMinutes().toString().padStart(2, '0')}`;
            const updatedStr = `${updatedDate.getFullYear()}-${(updatedDate.getMonth()+1).toString().padStart(2, '0')}-${updatedDate.getDate().toString().padStart(2, '0')} ${updatedDate.getHours().toString().padStart(2, '0')}:${updatedDate.getMinutes().toString().padStart(2, '0')}`;
            
            // æ„å»ºè¯¦æƒ…å†…å®¹
            let detailHTML = `
                <p><strong>æ¯”èµ›åç§°:</strong> ${game.name}</p>
                <p><strong>åˆ›å»ºæ—¶é—´:</strong> ${createdStr}</p>
                <p><strong>æœ€åæ›´æ–°:</strong> ${updatedStr}</p>
                <p><strong>æ¯”èµ›çŠ¶æ€:</strong> ${isCompleted ? 'å·²å®Œæˆ' : `è¿›è¡Œä¸­ (ç¬¬${game.currentRound}è½®)`}</p>
                <p><strong>æ¯”èµ›ç»“æœ:</strong> ç”²ç»„ ${totalScoreA} : ${totalScoreB} ä¹™ç»„ (${winner}${totalScoreA === totalScoreB ? 'ï¼Œéœ€åŠ èµ›' : 'è·èƒœ'})</p>
                
                <h4 style="margin-top: 15px;">é€‰æ‰‹åˆ—è¡¨</h4>
                <div style="display: flex; gap: 15px;">
                    <div>
                        <strong>ç”²ç»„:</strong>
                        <ul style="margin-top: 5px; padding-left: 20px;">
                            ${game.groups.A.map(player => `<li>${player}</li>`).join('')}
                        </ul>
                    </div>
                    <div>
                        <strong>ä¹™ç»„:</strong>
                        <ul style="margin-top: 5px; padding-left: 20px;">
                            ${game.groups.B.map(player => `<li>${player}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                
                <h4 style="margin-top: 15px;">æ¯è½®å¾—åˆ†</h4>
                <table class="score-table" style="font-size: 0.9rem;">
                    <thead>
                        <tr>
                            <th>è½®æ¬¡</th>
                            <th>ç”²ç»„å¾—åˆ†</th>
                            <th>ä¹™ç»„å¾—åˆ†</th>
                            <th>ç¬¬ä¸€å</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (let round = 1; round <= 6; round++) {
                const scoreA = game.scores.A[round - 1] || 0;
                const scoreB = game.scores.B[round - 1] || 0;
                const firstPlace = game.rankings[round] ? game.rankings[round][1] : '-';
                
                detailHTML += `
                    <tr>
                        <td>ç¬¬${round}è½®</td>
                        <td>${scoreA}</td>
                        <td>${scoreB}</td>
                        <td>${firstPlace}</td>
                    </tr>
                `;
            }
            
            detailHTML += `
                    </tbody>
                </table>
            `;
            
            detailContent.innerHTML = detailHTML;
            historyDetails.style.display = 'block';
            
            // æ»šåŠ¨åˆ°è¯¦æƒ…åŒºåŸŸ
            historyDetails.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // åŠ è½½é€‰ä¸­çš„å†å²è®°å½•
        function loadSelectedHistory() {
            if (!selectedHistoryId) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€æ¡å†å²è®°å½•ï¼');
                return;
            }
            
            const history = getHistory();
            const gameData = history[selectedHistoryId];
            
            if (!gameData) {
                alert('è®°å½•ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤ï¼');
                refreshHistoryList();
                return;
            }
            
            // ç¡®è®¤åŠ è½½
            if (!confirm(`ç¡®å®šè¦åŠ è½½"${gameData.name}"å—ï¼Ÿå½“å‰æœªä¿å­˜çš„æ•°æ®å°†ä¼šä¸¢å¤±ã€‚`)) {
                return;
            }
            
            // åŠ è½½æ¸¸æˆæ•°æ®
            Object.assign(gameState, gameData);
            
            // æ›´æ–°UI
            displayGroups();
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            alert(`æ¯”èµ›"${gameData.name}"å·²åŠ è½½æˆåŠŸï¼`);
            
            // åˆ‡æ¢åˆ°æ¸¸æˆé¡µé¢
            switchPage('game');
        }
        
        // åˆ é™¤é€‰ä¸­çš„å†å²è®°å½•
        function deleteSelectedHistory() {
            if (!selectedHistoryId) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€æ¡å†å²è®°å½•ï¼');
                return;
            }
            
            const history = getHistory();
            const gameData = history[selectedHistoryId];
            
            if (!gameData) {
                alert('è®°å½•ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤ï¼');
                refreshHistoryList();
                return;
            }
            
            // ç¡®è®¤åˆ é™¤
            if (!confirm(`ç¡®å®šè¦åˆ é™¤"${gameData.name}"å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`)) {
                return;
            }
            
            // åˆ é™¤è®°å½•
            delete history[selectedHistoryId];
            localStorage.setItem('daguailuzi_history', JSON.stringify(history));
            
            // é‡ç½®é€‰ä¸­ID
            selectedHistoryId = null;
            
            // éšè—è¯¦æƒ…
            document.getElementById('historyDetails').style.display = 'none';
            
            // åˆ·æ–°åˆ—è¡¨
            refreshHistoryList();
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            alert('è®°å½•å·²åˆ é™¤ï¼');
        }
        
        // æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•
        function clearAllHistory() {
            const history = getHistory();
            if (Object.keys(history).length === 0) {
                alert('æš‚æ— å†å²è®°å½•å¯æ¸…ç©ºï¼');
                return;
            }
            
            // ç¡®è®¤æ¸…ç©º
            if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                return;
            }
            
            // æ¸…ç©ºå†å²è®°å½•
            localStorage.removeItem('daguailuzi_history');
            
            // é‡ç½®é€‰ä¸­ID
            selectedHistoryId = null;
            
            // éšè—è¯¦æƒ…
            document.getElementById('historyDetails').style.display = 'none';
            
            // åˆ·æ–°åˆ—è¡¨
            refreshHistoryList();
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            alert('æ‰€æœ‰å†å²è®°å½•å·²æ¸…ç©ºï¼');
        }
        
        // åˆ‡æ¢é¡µé¢
        function switchPage(pageName) {
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            mobileTabs.forEach(tab => {
                if (tab.dataset.page === pageName) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            // æ›´æ–°é¡µé¢æ˜¾ç¤º
            pageSections.forEach(section => {
                if (section.id === pageName + 'Page') {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });
            
            // å¦‚æœæ˜¯PCç«¯ï¼Œæ˜¾ç¤ºæ‰€æœ‰å†…å®¹
            if (window.innerWidth >= 768) {
                // PCç«¯ç‰¹æ®Šå¤„ç†ï¼šæ˜¾ç¤ºæ‰€æœ‰é¡µé¢å†…å®¹
                pageSections.forEach(section => {
                    section.classList.add('active');
                });
            }
            
            // å¦‚æœæ˜¯å†å²è®°å½•é¡µé¢ï¼Œåˆ·æ–°åˆ—è¡¨
            if (pageName === 'history') {
                refreshHistoryList();
            }
            
            // æ»šåŠ¨åˆ°é¡¶éƒ¨
            window.scrollTo(0, 0);
        }
        
        // äº‹ä»¶ç›‘å¬
        startGameBtn.addEventListener('click', () => {
            if (initGame()) {
                displayGroups();
            }
        });
        
        resetAllBtn.addEventListener('click', () => {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ•°æ®å—ï¼Ÿå½“å‰æœªä¿å­˜çš„æ•°æ®å°†ä¼šä¸¢å¤±ï¼')) {
                // é‡ç½®æ¸¸æˆçŠ¶æ€
                gameState.players = [];
                gameState.groups = { A: [], B: [] };
                gameState.currentRound = 1;
                gameState.rankings = {};
                gameState.scores = { A: Array(6).fill(0), B: Array(6).fill(0) };
                gameState.playerStats = {};
                gameState.gameId = null;
                gameState.gameName = '';
                gameState.createdAt = null;
                gameState.updatedAt = null;
                
                // æ¸…ç©ºè¾“å…¥
                for (let i = 1; i <= 6; i++) {
                    document.getElementById(`player${i}`).value = '';
                }
                
                // é‡ç½®UI
                document.getElementById('groupAList').innerHTML = '';
                document.getElementById('groupBList').innerHTML = '';
                document.getElementById('saveName').value = '';
                document.getElementById('saveMessage').style.display = 'none';
                
                // åˆ‡æ¢åˆ°è¾“å…¥é¡µé¢
                switchPage('input');
                
                // é”€æ¯å›¾è¡¨
                if (scoreChart) {
                    scoreChart.destroy();
                    scoreChart = null;
                }
                if (rankingChart) {
                    rankingChart.destroy();
                    rankingChart = null;
                }
                if (teamScoreChart) {
                    teamScoreChart.destroy();
                    teamScoreChart = null;
                }
                if (firstPlaceChart) {
                    firstPlaceChart.destroy();
                    firstPlaceChart = null;
                }
            }
        });
        
        prevRoundBtn.addEventListener('click', () => {
            if (gameState.currentRound > 1) {
                gameState.currentRound--;
                initRankingInput();
                updateGameControls();
                
                // æ›´æ–°å¯è§†åŒ–å›¾è¡¨
                updateAllCharts();
            }
        });
        
        nextRoundBtn.addEventListener('click', () => {
            if (gameState.currentRound < 6 && gameState.rankings[gameState.currentRound]) {
                gameState.currentRound++;
                initRankingInput();
                updateGameControls();
            } else if (!gameState.rankings[gameState.currentRound]) {
                alert('è¯·å…ˆæäº¤å½“å‰è½®æ¬¡çš„æ’åï¼');
            }
        });
        
        submitRoundBtn.addEventListener('click', submitRoundRankings);
        
        continueGameBtn.addEventListener('click', () => {
            // å¦‚æœä¸æ˜¯æœ€åä¸€è½®ï¼Œè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€è½®
            if (gameState.currentRound < 6) {
                switchPage('game');
            } else {
                // å¦‚æœæ˜¯æœ€åä¸€è½®ï¼Œæ˜¾ç¤ºæœ€ç»ˆç»“æœ
                calculateFinalResults();
                switchPage('results');
            }
        });
        
        viewChartsBtn.addEventListener('click', () => {
            switchPage('visualization');
        });
        
        backToStatsBtn.addEventListener('click', () => {
            switchPage('stats');
        });
        
        backToGameBtn.addEventListener('click', () => {
            switchPage('game');
        });
        
        viewHistoryBtn.addEventListener('click', () => {
            switchPage('history');
        });
        
        saveGameBtn.addEventListener('click', () => {
            saveCurrentGame();
        });
        
        saveCurrentBtn.addEventListener('click', () => {
            // åˆ‡æ¢åˆ°æ¸¸æˆé¡µé¢å¹¶èšç„¦ä¿å­˜è¾“å…¥æ¡†
            switchPage('game');
            setTimeout(() => {
                document.getElementById('saveName').focus();
            }, 100);
        });
        
        saveFinalResultBtn.addEventListener('click', () => {
            if (gameState.currentRound === 6 && Object.keys(gameState.rankings).length === 6) {
                // å¦‚æœæ¸¸æˆåç§°ä¸ºç©ºï¼Œæç¤ºè¾“å…¥
                if (!gameState.gameName) {
                    const gameName = prompt('è¯·è¾“å…¥æ¯”èµ›åç§°ï¼š', `æ¯”èµ› ${new Date().toLocaleDateString()}`);
                    if (gameName) {
                        gameState.gameName = gameName;
                        saveCurrentGame();
                    }
                } else {
                    saveCurrentGame();
                }
            } else {
                alert('è¯·å…ˆå®Œæˆæ‰€æœ‰å…­è½®æ¯”èµ›ï¼');
            }
        });
        
        refreshHistoryBtn.addEventListener('click', () => {
            refreshHistoryList();
        });
        
        clearAllHistoryBtn.addEventListener('click', clearAllHistory);
        
        loadSelectedHistoryBtn.addEventListener('click', loadSelectedHistory);
        
        deleteSelectedHistoryBtn.addEventListener('click', deleteSelectedHistory);
        
        closeHistoryDetailsBtn.addEventListener('click', () => {
            document.getElementById('historyDetails').style.display = 'none';
            // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çš„é¡¹ç›®
            document.querySelectorAll('.history-item').forEach(item => {
                item.classList.remove('active');
            });
            selectedHistoryId = null;
        });
        
        // ç§»åŠ¨ç«¯æ ‡ç­¾é¡µç‚¹å‡»äº‹ä»¶
        mobileTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                switchPage(tab.dataset.page);
            });
        });
        
        // çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´æ˜¾ç¤º
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 768) {
                // PCç«¯æ˜¾ç¤ºæ‰€æœ‰é¡µé¢å†…å®¹
                pageSections.forEach(section => {
                    section.classList.add('active');
                });
            } else {
                // ç§»åŠ¨ç«¯åªæ˜¾ç¤ºå½“å‰é¡µé¢å†…å®¹
                const activeTab = document.querySelector('.mobile-tab.active');
                if (activeTab) {
                    switchPage(activeTab.dataset.page);
                }
            }
        });
        
        // åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®
        function initExampleData() {
            // ç¤ºä¾‹é€‰æ‰‹å§“å
            const exampleNames = ['', '', '', '', '', ''];
            
            exampleNames.forEach((name, index) => {
                document.getElementById(`player${index + 1}`).value = name;
            });
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®
        window.addEventListener('DOMContentLoaded', initExampleData);
        
        // é¡µé¢åŠ è½½åè®¾ç½®åˆå§‹æ˜¾ç¤º
        window.addEventListener('DOMContentLoaded', () => {
            if (window.innerWidth >= 768) {
                // PCç«¯æ˜¾ç¤ºæ‰€æœ‰é¡µé¢å†…å®¹
                pageSections.forEach(section => {
                    section.classList.add('active');
                });
            }
        });
    </script>
</body>
</html>